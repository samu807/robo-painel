<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Painel de Controle do Rob√¥</title>
<script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/nipplejs@0.9.0/dist/nipplejs.min.js"></script>
<style>
  body {
    font-family: Arial, sans-serif;
    text-align: center;
    margin: 20px;
  }

  /* V√≠deo */
  #videoContainer {
    width: 640px;
    max-width: 90%;
    height: 360px;
    margin: 0 auto 40px auto;
    display: block;
  }

  #videoContainer iframe {
    width: 100%;
    height: 100%;
    border: 2px solid #333;
    display: block;
  }

  /* Joystick */
  #joystick {
    width: 200px;
    max-width: 80%;
    aspect-ratio: 1;
    margin: 0 auto 20px auto;
    background: #eee;
    border-radius: 50%;
    display: block;
    position: relative; /* Essencial para o c√≠rculo azul do NippleJS ficar correto */
  }

  #status {
    margin-top: 10px;
    font-weight: bold;
  }

  /* Bot√£o de desligamento */
  #btnShutdown {
    margin-top: 20px;
    padding: 10px 20px;
    font-size: 16px;
    background-color: #e74c3c;
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
  }

  #btnShutdown:hover {
    background-color: #c0392b;
  }
</style>
</head>
<body>

<h2>Painel de Controle do Rob√¥</h2>

<!-- V√≠deo -->
<div id="videoContainer">
  <iframe src="https://robo.pedmv.online/cam1/" allowfullscreen></iframe>

</div>

<!-- Joystick -->
<div id="joystick"></div>
<div id="status">Conectando ao HiveMQ...</div>

<!-- Bot√£o de desligamento -->
<button id="btnShutdown">Desligar</button>

<script>
// Conex√£o MQTT
const client = mqtt.connect('wss://broker.hivemq.com:8884/mqtt');

client.on('connect', () => {
  document.getElementById('status').textContent = '‚úÖ Conectado ao HiveMQ!';
  console.log('Conectado ao HiveMQ');
});

client.on('error', (err) => {
  document.getElementById('status').textContent = '‚ùå Erro: ' + err.message;
  console.error('Erro MQTT:', err);
});

// Joystick responsivo
const joystickContainer = document.getElementById('joystick');
const joystickSize = Math.min(joystickContainer.offsetWidth, 200);

const joystick = nipplejs.create({
  zone: joystickContainer,
  mode: 'static',
  position: { left: '50%', top: '50%' },
  color: 'blue',
  size: joystickSize
});

function angleToDirection(angle) {
  if (angle >= 45 && angle < 135) return 'frente';
  else if (angle >= 135 && angle < 225) return 'esquerda';
  else if (angle >= 225 && angle < 315) return 'tras';
  else return 'direita';
}

joystick.on('move', (evt, data) => {
  if (!data.angle || !data.distance) return;
  const angle = data.angle.degree;
  const distance = data.distance;
  const direction = angleToDirection(angle);
  const speed = Math.min(Math.round(distance * 100 / 75), 100);

  client.publish('robo/comando', JSON.stringify({ direcao: direction, velocidade: speed }));
  document.getElementById('status').textContent = `‚Üí ${direction.toUpperCase()} | Velocidade: ${speed}`;
});

joystick.on('end', () => {
  client.publish('robo/comando', JSON.stringify({ direcao: 'parar', velocidade: 0 }));
  document.getElementById('status').textContent = 'üõë Parar';
});

// Bot√£o de desligamento
document.getElementById('btnShutdown').addEventListener('click', () => {
  client.publish('robo/shutdown', 'shutdown');
  alert('‚ö†Ô∏è Comando de desligamento enviado!');
});
</script>

</body>
</html>

<!-- Bot√£o de Dashboard -->
<http://3.16.150.177:3000/public/dashboard/f2aca777-bf22-4dbb-a79a-afd9507b0716" target="_blank" id="btnDashboard">Georreferenciamento</a>

<style>
  /* Bot√£o de Dashboard - mesmo estilo do desligamento */
  #btnDashboard {
    display: inline-block;
    margin-top: 10px;
    padding: 10px 20px;
    font-size: 16px;
    background-color: #3498db; /* azul para diferenciar do vermelho */
    color: white;
    text-decoration: none;
    border: none;
    border-radius: 5px;
    cursor: pointer;
  }

  #btnDashboard:hover {
    background-color: #2980b9;
  }
</style>

/* azul para diferenciar do vermelho */


